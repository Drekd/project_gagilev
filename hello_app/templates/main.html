{% extends "index.html" %}
{% block content %}
<main class="main-content">
    <div class="container">
        <section class="search-section">
            <h2 class="search-title">Найдите автомобиль вашей мечты</h2>
            <form class="search-form" method="GET" action="{% url 'car' %}">
                <div class="form-group">
                    <label for="brand">Марка автомобиля</label>
                    <select id="brand" name="brand" class="form-select">
                        <option value="">Все марки</option>
                        {% for brand in brands %}
                        <option value="{{ brand }}" {% if selected_brand == brand %}selected{% endif %}>{{ brand }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <button type="submit" class="search-btn">Найти</button>
                {% if selected_brand %}
                <button type="button" class="search-btn secondary" onclick="clearFilter()">Сбросить</button>
                {% endif %}
            </form>
        </section>

        <section>
            <h2 class="section-title">
                {% if selected_brand %}
                    Автомобили марки {{ selected_brand }}
                {% else %}
                    Автомобили в наличии
                {% endif %}
            </h2>
            <div class="cars-grid">
                {% for car in cars %}
                <div class="car-card">
                    {% if car.image %}
                        <img src="{{ car.image.url }}" alt="{{ car.name }}" class="car-image">
                    {% else %}
                        <img src="/static/image/584x438.webp" alt="{{ car.name }}" class="car-image">
                    {% endif %}
                    <div class="car-info">
                        <div class="car-name">{{ car.name }}</div>
                        <div class="car-price">{{ car.price }} ₽</div>
                        <div class="car-details">
                            <p>Год: {{ car.year }}</p>
                            <p>Комплектация: {{ car.equipment }}</p>
                            <p>Цвет: {{ car.colour }}</p>
                            <p>Категория: {{ car.categories_id.name }}</p>
                        </div>
                        <a href="{% url 'car' %}" class="btn">Подробнее</a>
                    </div>
                </div>
                {% empty %}
                <p>Автомобилей нет в наличии</p>
                {% endfor %}
            </div>
        </section>

        <section>
            <h2 class="section-title">Наши продавцы</h2>
            <div class="sellers-grid">
                {% for seller in sellers %}
                <div class="seller-card">
                    {% if seller.photo %}
                        <img src="{{ seller.photo.url }}" alt="{{ seller.first_name }} {{ seller.last_name }}" class="seller-photo">
                    {% else %}
                        <img src="/static/image/vadim.webp" alt="{{ seller.first_name }} {{ seller.last_name }}" class="seller-photo">
                    {% endif %}
                    <div class="seller-name">{{ seller.last_name }} {{ seller.first_name }} {{ seller.father_name }}</div>
                    <div class="seller-position">{{ seller.post_id.post }}</div>
                    <div class="seller-phone">{{ seller.phone_number }}</div>
                </div>
                {% empty %}
                <p>Информация о продавцах временно недоступна</p>
                {% endfor %}
            </div>
        </section>
    </div>
</main>

<script>
function clearFilter() {
    // Перенаправляем на страницу без параметров фильтра
    window.location.href = "{% url 'main' %}";
}

// Автоматическая отправка формы при выборе марки (опционально)
document.addEventListener('DOMContentLoaded', function() {
    const brandSelect = document.getElementById('brand');
    
    if (brandSelect) {
        brandSelect.addEventListener('change', function() {
            // Если выбрана какая-то марка (не "Все марки"), отправляем форму
            if (this.value) {
                this.form.submit();
            }
        });
    }
});
</script>
{% endblock %}