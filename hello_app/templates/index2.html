{% extends "index.html" %}
{% block content %}
<main class="main-content">
    <div class="container">
        <nav class="breadcrumbs">
            <a href="{% url 'main' %}">Главная</a>
            <span></span>
            <span>Автомобили</span>
        </nav>

        <section class="page-header">
            <h1 class="page-title">
                {% if selected_brand %}
                    Каталог автомобилей {{ selected_brand }}
                {% else %}
                    Каталог автомобилей
                {% endif %}
            </h1>
            <p class="page-subtitle">Большой выбор новых и подержанных автомобилей</p>
        </section>

        <!-- Простой фильтр по марке -->
        <section class="filters-section">
            <div class="filters-header">
                {% if selected_brand %}
                <button class="reset-filters" onclick="clearFilter()">Показать все марки</button>
                {% endif %}
            </div>
            
            <form class="filters-form" method="GET">
                <div class="filters-grid" style="grid-template-columns: 300px auto;">
                    <div class="filter-group">
                        <label for="car-brand">Выберите марку</label>
                        <select id="car-brand" name="brand" class="filter-select">
                            <option value="">Все марки</option>
                            {% for brand in brands %}
                            <option value="{{ brand }}" {% if selected_brand == brand %}selected{% endif %}>{{ brand }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-actions">
                        <button type="submit" class="filter-btn primary">Применить</button>
                        {% if selected_brand %}
                        <button type="button" class="filter-btn secondary" onclick="clearFilter()">Сбросить</button>
                        {% endif %}
                    </div>
                </div>
            </form>
        </section>

        <!-- Результаты поиска -->
        <section class="results-section">
            <div class="results-header">
                <div class="results-info">
                    <span class="results-count">
                        {% if selected_brand %}
                            Найдено {{ cars_count }} автомобилей марки {{ selected_brand }}
                        {% else %}
                            Найдено {{ cars_count }} автомобилей
                        {% endif %}
                    </span>
                </div>
            </div>

            <!-- Сетка автомобилей -->
            <div class="cars-grid extended">
                {% for car in cars %}
                <div class="car-card detailed">
                    <div class="car-badge new">Новый</div>
                    {% if car.image %}
                        <img src="{{ car.image.url }}" alt="{{ car.name }}" class="car-image">
                    {% else %}
                        <img src="/static/image/584x438.webp" alt="{{ car.name }}" class="car-image">
                    {% endif %}
                    <div class="car-info">
                        <h3 class="car-name">{{ car.name }}</h3>
                        <div class="car-price">{{ car.price }} ₽</div>
                        <div class="car-specs">
                            <div class="spec-item">
                                <span class="spec-label">Год:</span>
                                <span class="spec-value">{{ car.year }}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Комплектация:</span>
                                <span class="spec-value">{{ car.equipment }}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Цвет:</span>
                                <span class="spec-value">{{ car.colour }}</span>
                            </div>
                            <div class="spec-item">
                                <span class="spec-label">Категория:</span>
                                <span class="spec-value">{{ car.categories_id.name }}</span>
                            </div>
                        </div>
                        <div class="car-actions">
                            <a href="#" class="btn primary">Подробнее</a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                    <p style="font-size: 18px; color: #666;">
                        {% if selected_brand %}
                            Автомобили марки "{{ selected_brand }}" не найдены
                        {% else %}
                            Автомобили не найдены
                        {% endif %}
                    </p>
                </div>
                {% endfor %}
            </div>
        </section>
    </div>
</main>

<script>
function clearFilter() {
    // Перенаправляем на страницу без параметров фильтра
    window.location.href = "{% url 'car' %}";
}

// Автоматическая отправка формы при выборе марки
document.addEventListener('DOMContentLoaded', function() {
    const brandSelect = document.getElementById('car-brand');
    
    if (brandSelect) {
        brandSelect.addEventListener('change', function() {
            // Если выбрана какая-то марка (не "Все марки"), отправляем форму
            if (this.value) {
                this.form.submit();
            }
        });
    }
});
</script>
{% endblock %}